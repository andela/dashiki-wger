{% extends "base.html" %}
{% load i18n staticfiles wger_extras django_bootstrap_breadcrumbs %}

{% block title %} Compare members {% endblock %}

{#        #}
{# Header #}
{#        #}
{% block header %}
    <script src="{% static 'js/compare_weight.js' %}"></script>
    <script src="{% static 'js/compare_energy.js' %}"></script>
    <script src="{% static 'js/compare_fat.js' %}"></script>
    <script src="{% static 'js/compare_protein.js' %}"></script>
    <script src="{% static 'js/compare_carbohydrates.js' %}"></script>
{% endblock %}

{% block breadcrumbs %}
    {% if current_user.userprofile.gym %}
        {{ block.super }}

        {% if perms.gym.manage_gyms %}
            {% breadcrumb "Gyms" "gym:gym:list" %}
        {% endif %}
        {% breadcrumb_raw current_user.userprofile.gym "gym:gym:user-list" current_user.userprofile.gym.pk %}
        {% breadcrumb_raw current_user|format_username "core:user:overview" current_user.pk %}
    {% endif %}
{% endblock %}


{% block content %}
    {% url 'core:user:trainer-login' current_user.pk as trainer_login %}
    {% if perms.gym.gym_trainer %}
        <h4>{% trans "Weight" %}</h4>
        <div id="members" data-current-username="{{ users }}"></div>
        <div id="weight_diagram"></div>
        <div class="legend"></div>
        <hr/>
        <h4> {% trans "Weight Details" %} </h4>

        <ul class="nav nav-tabs">
            {% for user in weight_entries.keys %}
              <li><a data-toggle="tab" href="#{{ user.username }}">{{ user.username }}</a></li>
            {% endfor %}
        </ul>
        <div class="tab-content">
            {% for user, weight_list in weight_entries.items %}
              <div id="{{ user }}" class="tab-pane fade">
                <p>
                  <h4>
                    {{ user }} {% trans "Weight" %}
                    <small>
                        ({% blocktrans with number=5 %}last {{ number }}{% endblocktrans %})
                    </small>
                </h4>

                <table class="table">
                    <thead>
                        <tr>
                            <th style="width: 25%;">{% trans "Date" %}</th>
                            <th>{% trans "Weight" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for weight in weight_list %}
                        <tr>
                            <td>
                                {{weight.date}}
                            </td>
                            <td>
                                {{weight.weight}} {% trans_weight_unit 'kg' current_user %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="3">{% trans "Nothing found" %}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
                </p>
              </div>
            {% endfor %}
        </div>
        <hr/>

        <h3>Nutritional Data</h3>
        <!-- Energy Graph -->
        <div id="energy" data-current-username="{{ users }}"></div>
        <div id="energy_diagram"></div>
        <div id="energy_legend"></div>
        <hr/>

        <!-- Fat Graph -->
        <div id="fat" data-current-username="{{ users }}"></div>
        <div id="fat_diagram"></div>
        <div id="fat_legend"></div>
        <hr/>

        <!-- Protein Graph -->
        <div id="protein" data-current-username="{{ users }}"></div>
        <div id="protein_diagram"></div>
        <div id="protein_legend"></div>
        <hr/>

        <!-- Carbohydrates Graph -->
        <div id="carbohydrates" data-current-username="{{ users }}"></div>
        <div id="carbohydrates_diagram"></div>
        <div id="carbohydrates_legend"></div>
        <hr/>
        <h4> {% trans "Nutritional Data Details" %} </h4>
        <ul class="nav nav-tabs">
            {% for user in nutrition_plans.keys %}
              <li><a data-toggle="tab" href="#nutrition{{ user.username }}">{{ user.username }}</a></li>
            {% endfor %}
        </ul>
        <div class="tab-content">
            {% for user, plans in nutrition_plans.items %}
              <div id="nutrition{{ user.username }}" class="tab-pane fade">
                  <p>
                    <table class="table">
                    <thead>
                    <tr>
                        <th style="width: 25%;">{% trans "Date" %}</th>
                        <th>{% trans "Description" %}</th>
                        <th>{% trans "Energy" %}</th>
                        <th>{% trans "Protein" %}</th>
                        <th>{% trans "Carbohydrates" %}</th>
                        <th>{% trans "Fat" %}</th>
                    </tr>
                    </thead>
                    <tbody>

                    {% for nutrition_plan in plans %}
                    <tr>
                        <td>
                            {{nutrition_plan.creation_date}}
                        </td>
                        <td>
                            <a href="{{trainer_login}}?next={{ nutrition_plan.get_absolute_url }}">
                                {{nutrition_plan}}
                            </a>
                        </td>
                        <td>
                            {{nutrition_plan.get_nutritional_values.total.energy|floatformat}}
                            {% trans "kcal" %}
                        </td>
                        <td>
                            {{nutrition_plan.get_nutritional_values.total.protein|floatformat}}
                            {% trans_weight_unit 'g' current_user %}
                        </td>
                        <td>
                            {{nutrition_plan.get_nutritional_values.total.carbohydrates|floatformat}}
                            {% trans_weight_unit 'g' current_user %}
                        </td>
                        <td>
                            {{nutrition_plan.get_nutritional_values.total.fat|floatformat}}
                            {% trans_weight_unit 'g' current_user %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6">
                            {% trans "Nothing found" %}
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                    </table>
                  </p>
              </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}
